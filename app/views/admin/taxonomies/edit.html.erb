<%= render :partial => 'admin/shared/configuration_menu' %>

<%= render :partial => "js_head" %>

<h1><%= t("taxonomy_edit")%></h1>

<p id="ajax_error" class="errorExplanation" style="display:none;"></p>

<% form_for(:taxon, :url => admin_taxonomy_url, :html => { :method => :put }) do |f| %>
  <%= render :partial => 'form', :locals => {:f => f} %>
	  <div>
	    <label><%= t("tree")%></label><br />
      <div id="taxonomy_tree" class="tree">
        <ul>
          <li id="<%= @taxonomy.root.id %>" class="open" rel="root">
            <a href="#"><%= @taxonomy.root.name %></a>
            <%= render :partial => "taxons", :locals => {:taxon => @taxonomy.root} %>
          </li>
        </ul>
      </div>
  	</div>
  	<p id="progress" style="display:none;">
      <img src="/images/spinner.gif?1234540747" alt="Spinner" style="vertical-align:bottom;"/> <%= t('updating') %>..
    </p>
    <p><br/><small><%= t("taxonomy_tree_instruction")%></small></p>

	<p class="form-buttons">
	  <%= button t("update") %> <%= t("or") %> <%= link_to t("cancel"), admin_taxonomies_path %>
  </p>
<% end %>

<div id="product-group-select" style="display:none">
  <div id="product-group-select-searching" style="display:none">
  	<%= t("searching") %> &nbsp; <%= image_tag "spinner.gif" %>
  </div>
  <% form_tag('#') do %>
    <label><%= t('search') %>:</label>
    <input id="product-group-select-searchtext" size="25">
  <% end %>

  
  <br/>                 
  <div id="product-group-select-search-hits"></div>
  <p class="form-buttons">
    <%= button_link_to_function t('cancel'), %q{product_group_select_clear()} %>
  </p>
</div>

<% javascript_tag do %> 
  var product_group_select_glob = null;
  var product_group_select_clear = function() {
    product_group_select_glob = null;
    jQuery('#product-group-select-searchtext').val('');
	jQuery('#product-group-select-search-hits').html('');
	jQuery('#product-group-select-searching').hide();
	jQuery('#product-group-select').hide();
  };
	
  jQuery(document).ready(function() {
  jQuery('#product-group-select-searchtext').delayedObserver(function() {
     jQuery.ajax({ beforeSend:function(request){jQuery('#product-group-select-searching').show;}, 
              complete:function(request){jQuery('#product-group-select-searching').hide;}, 
              data:'q=' + this[0].value + '&authenticity_token=' + encodeURIComponent(AUTH_TOKEN), 
              success:function(request){jQuery('#product-group-select-search-hits').html(request);}, 
              error: generic_ajax_error,
              type:'get',  
	          url:'<%= admin_taxons_url %>/' + product_group_select_glob.taxon_id + '/product_groups/available' }, 0.75)}); 
	});
<% end %>

